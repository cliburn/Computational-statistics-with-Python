

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from people.duke.edu/~ccc14/sta-663-2017/14C_Optimization_In_Python.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 14 Apr 2017 01:11:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using optimization routines from scipy and statsmodels &#8212; STA-663-2017 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.base.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Random numbers and probability models" href="15A_Random_Numbers.html" />
    <link rel="prev" title="Algorithms for Optimization and Root Finding for Multivariate Problems" href="14B_Multivariate_Optimization.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body role="document">
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="15A_Random_Numbers.html" title="Random numbers and probability models"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="14B_Multivariate_Optimization.html" title="Algorithms for Optimization and Root Finding for Multivariate Problems"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="index-2.html">STA-663-2017 1.0 documentation</a> &#187;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-optimization-routines-from-scipy-and-statsmodels">
<h1>Using optimization routines from <code class="docutils literal"><span class="pre">scipy</span></code> and <code class="docutils literal"><span class="pre">statsmodels</span></code><a class="headerlink" href="#using-optimization-routines-from-scipy-and-statsmodels" title="Permalink to this headline">¶</a></h1>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="k">as</span> <span class="nn">la</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="finding-roots">
<h2>Finding roots<a class="headerlink" href="#finding-roots" title="Permalink to this headline">¶</a></h2>
<p>For root finding, we generally need to provide a starting point in the
vicinity of the root. For iD root finding, this is often provided as a
bracket (a, b) where a and b have opposite signs.</p>
<div class="section" id="univariate-roots-and-fixed-points">
<h3>Univariate roots and fixed points<a class="headerlink" href="#univariate-roots-and-fixed-points" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_7_0.png" src="_images/14C_Optimization_In_Python_7_0.png" />
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">brentq</span><span class="p">,</span> <span class="n">newton</span>
</pre></div>
</div>
<div class="section" id="brentq-is-the-recommended-method">
<h4><code class="docutils literal"><span class="pre">brentq</span></code> is the recommended method<a class="headerlink" href="#brentq-is-the-recommended-method" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">brentq</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">brentq</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">brentq</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">-</span><span class="mf">1.8793852415718166</span><span class="p">,</span> <span class="mf">0.3472963553337031</span><span class="p">,</span> <span class="mf">1.532088886237956</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="secant-method">
<h4>Secant method<a class="headerlink" href="#secant-method" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">-</span><span class="mf">1.8793852415718169</span><span class="p">,</span> <span class="mf">0.34729635533385395</span><span class="p">,</span> <span class="mf">1.5320888862379578</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="newton-raphson-method">
<h4>Newton-Raphson method<a class="headerlink" href="#newton-raphson-method" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">fprime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span>
<span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">fprime</span><span class="p">),</span> <span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fprime</span><span class="p">),</span> <span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">fprime</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">-</span><span class="mf">1.8793852415718166</span><span class="p">,</span> <span class="mf">0.34729635533386066</span><span class="p">,</span> <span class="mf">1.532088886237956</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="analytical-solution-using-sympy-to-find-roots-of-a-polynomial">
<h4>Analytical solution using <code class="docutils literal"><span class="pre">sympy</span></code> to find roots of a polynomial<a class="headerlink" href="#analytical-solution-using-sympy-to-find-roots-of-a-polynomial" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">real_roots</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">real_roots</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">sol</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">-</span><span class="mf">1.87938524157182</span><span class="p">,</span> <span class="mf">0.347296355333861</span><span class="p">,</span> <span class="mf">1.53208888623796</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="finding-fixed-points">
<h4>Finding fixed points<a class="headerlink" href="#finding-fixed-points" title="Permalink to this headline">¶</a></h4>
<p>Finding the fixed points of a function <span class="math">\(g(x) = x\)</span> is the same as
finding the roots of <span class="math">\(g(x) - x\)</span>. However, specialized algorithms
also exist - e.g. using <code class="docutils literal"><span class="pre">scipy.optimize.fixedpoint</span></code>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">fixed_point</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_20_0.png" src="_images/14C_Optimization_In_Python_20_0.png" />
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">fixed_point</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">fixed_point</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="n">fixed_point</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="mf">0.2541016883650524</span><span class="p">),</span>
 <span class="n">array</span><span class="p">(</span><span class="o">-</span><span class="mf">2.114907541476756</span><span class="p">),</span>
 <span class="n">array</span><span class="p">(</span><span class="mf">1.8608058531117035</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">newton</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">newton</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="n">newton</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">0.2541016883650524</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.114907541476814</span><span class="p">,</span> <span class="mf">1.8608058531117062</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Discrete logistic equation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">fps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">n</span><span class="p">)):</span>
    <span class="n">fps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixed_point</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">fps</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
<span class="k">pass</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_24_0.png" src="_images/14C_Optimization_In_Python_24_0.png" />
</div>
<div class="section" id="note-that-we-don-t-know-anything-about-the-stability-of-the-fixed-point">
<h4>Note that we don&#8217;t know anything about the <strong>stability</strong> of the fixed point<a class="headerlink" href="#note-that-we-don-t-know-anything-about-the-stability-of-the-fixed-point" title="Permalink to this headline">¶</a></h4>
<p>Beyond <span class="math">\(r = 3\)</span>, the fixed point is unstable, even chaotic, but we
would never know that just from the plot above.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">400</span><span class="p">)):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">xs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
<span class="k">pass</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_26_0.png" src="_images/14C_Optimization_In_Python_26_0.png" />
</div>
</div>
<div class="section" id="mutlivariate-roots-and-fixed-points">
<h3>Mutlivariate roots and fixed points<a class="headerlink" href="#mutlivariate-roots-and-fixed-points" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal"><span class="pre">root</span></code> to solve polynomial equations. Use <code class="docutils literal"><span class="pre">fsolve</span></code> for
non-polynomial equations.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">root</span><span class="p">,</span> <span class="n">fsolve</span>
</pre></div>
</div>
<p>Suppose we want to solve a sysetm of <span class="math">\(m\)</span> equations with <span class="math">\(n\)</span>
unknowns</p>
<p>Note that the equations are non-linear and there can be multiple
solutions. These can be interpreted as fixed points of a system of
differential equations.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="o">.</span><span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">sol</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span> <span class="mf">1.117</span><span class="p">,</span>  <span class="mf">0.83</span> <span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">fsolve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span> <span class="mf">1.117</span><span class="p">,</span>  <span class="mf">0.83</span> <span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">r0</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">f</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">f</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">f</span><span class="p">,[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">])</span>
<span class="n">r3</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">f</span><span class="p">,[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">r4</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">f</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>

<span class="n">roots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">r0</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">r1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">r2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">r3</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">r4</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">V</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span><span class="o">*</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">autumn</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">roots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">roots</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_34_0.png" src="_images/14C_Optimization_In_Python_34_0.png" />
<div class="section" id="we-can-also-give-the-jacobian">
<h4>We can also give the jacobian<a class="headerlink" href="#we-can-also-give-the-jacobian" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">jac</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[[</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">jac</span><span class="o">=</span><span class="n">jac</span><span class="p">)</span>
<span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">fun</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.117</span><span class="p">,</span>  <span class="mf">0.83</span> <span class="p">]),</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="check-that-values-found-are-really-roots">
<h4>Check that values found are really roots<a class="headerlink" href="#check-that-values-found-are-really-roots" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="starting-from-other-initial-conditions-different-roots-may-be-found">
<h4>Starting from other initial conditions, different roots may be found<a class="headerlink" href="#starting-from-other-initial-conditions-different-roots-may-be-found" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">sol</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span> <span class="mf">0.778</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.921</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="optimization-primer">
<h2>Optimization Primer<a class="headerlink" href="#optimization-primer" title="Permalink to this headline">¶</a></h2>
<p>We will assume that our optimization problem is to minimize some
univariate or multivariate function <span class="math">\(f(x)\)</span>. This is without loss
of generality, since to find the maximum, we can simply minimize
<span class="math">\(-f(x)\)</span>. We will also assume that we are dealing with multivariate
or real-valued smooth functions - non-smooth or discrete functions (e.g.
integer-valued) are outside the scope of this course.</p>
<p>To find the minimum of a function, we first need to be able to express
the function as a mathematical expresssion. For example, in least
squares regression, the function that we are optimizing is of the form
<span class="math">\(y_i - f(x_i, \theta)\)</span> for some parameter(s) <span class="math">\(\theta\)</span>. To
choose an appropirate optimization algorithm, we should at least answer
these two questions if possible:</p>
<ol class="arabic simple">
<li>Is the function convex?</li>
<li>Are there any constraints that the solution must meet?</li>
</ol>
<p>Finally, we need to realize that optimization methods are nearly always
designed to find local optima. For convex problems, there is only one
minimum and so this is not a problem. However, if there are multiple
local minima, often heuristics such as multiple random starts must be
adopted to find a &#8220;good&#8221; enough solution.</p>
<div class="section" id="is-the-function-convex">
<h3>Is the function convex?<a class="headerlink" href="#is-the-function-convex" title="Permalink to this headline">¶</a></h3>
<p>Convex functions are very nice because they have a <strong>single global
minimum</strong>, and there are very efficient algorithms for solving large
convex systems.</p>
<p>Intuitively, a function is convex if every chord joining two points on
the function lies above the function. More formally, a function is
convex if</p>
<div class="math">
\[f(ta + (1-t)b) \lt tf(a) + (1-t)f(b)\]</div>
<p>for some <span class="math">\(t\)</span> between 0 and 1 - this is shown in the figure below.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">ymax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="n">ymax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="mi">4</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">-</span><span class="mf">2.</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">-</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">))],</span>
                 <span class="n">edgecolor</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="mi">8</span><span class="p">)])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;ta + (1-t)b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;f(ta + (1-t)b) &lt; tf(a) + (1-t)f(b)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Convex function&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="n">font_manager</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1288</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">findfont</span><span class="p">:</span> <span class="n">Font</span> <span class="n">family</span> <span class="p">[</span><span class="s1">&#39;Humor Sans&#39;</span><span class="p">,</span> <span class="s1">&#39;Comic Sans MS&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="n">found</span><span class="o">.</span> <span class="n">Falling</span> <span class="n">back</span> <span class="n">to</span> <span class="n">Bitstream</span> <span class="n">Vera</span> <span class="n">Sans</span>
  <span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_family</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultFamily</span><span class="p">[</span><span class="n">fontext</span><span class="p">]))</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_45_1.png" src="_images/14C_Optimization_In_Python_45_1.png" />
<div class="section" id="warm-up-exercise">
<h4>Warm up exercise<a class="headerlink" href="#warm-up-exercise" title="Permalink to this headline">¶</a></h4>
<p>Show that <span class="math">\(f(x) = -\log(x)\)</span> is a convex function.</p>
</div>
<div class="section" id="checking-if-a-function-is-convex-using-the-hessian">
<h4>Checking if a function is convex using the Hessian<a class="headerlink" href="#checking-if-a-function-is-convex-using-the-hessian" title="Permalink to this headline">¶</a></h4>
<p>The formal definition is only useful for checking if a function is
convex if you can find a counter-example. More practically, a twice
differentiable function is convex if its Hessian is positive
semi-definite, and strictly convex if the Hessian is positive definite.</p>
<p>For example, suppose we want to minimize the scalar-valued function</p>
<div class="math">
\[f(x_1, x_2, x_3) = x_1^2 + 2x_2^2 + 3x_3^2 + 2x_1x_2 + 2x_1x_3\]</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">hessian</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">init_printing</span><span class="p">,</span> <span class="n">expand</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">diff</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x y z&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">Function</span><span class="p">)</span>
<span class="n">init_printing</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">z</span>
<span class="n">f</span>
</pre></div>
</div>
<div class="math">
\[x^{2} + 2 x y + 2 x z + 2 y^{2} + 3 z^{2}\]</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">H</span> <span class="o">=</span> <span class="n">hessian</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
<span class="n">H</span>
</pre></div>
</div>
<div class="math">
\[\begin{split}\left[\begin{matrix}2 &amp; 2 &amp; 2\\2 &amp; 4 &amp; 0\\2 &amp; 0 &amp; 6\end{matrix}\right]\end{split}\]</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">real_if_close</span><span class="p">(</span><span class="n">la</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span> <span class="mf">0.241</span><span class="p">,</span>  <span class="mf">7.064</span><span class="p">,</span>  <span class="mf">4.695</span><span class="p">])</span>
</pre></div>
</div>
<p>Since the matrix is symmetric and all eigenvalues are positive, the
Hessian is positive defintie and the function is convex.</p>
</div>
<div class="section" id="combining-convex-functions">
<h4>Combining convex functions<a class="headerlink" href="#combining-convex-functions" title="Permalink to this headline">¶</a></h4>
<p>The following rules may be useful to determine if more complex functions
are convex:</p>
<ol class="arabic simple">
<li>The intersection of convex functions is convex</li>
<li>If the functions <span class="math">\(f\)</span> and <span class="math">\(g\)</span> are convex and
<span class="math">\(a \ge 0\)</span> and <span class="math">\(b \ge 0\)</span> then the function <span class="math">\(af + bg\)</span>
is convex.</li>
<li>If the function <span class="math">\(U\)</span> is convex and the function <span class="math">\(g\)</span> is
nondecreasing and convex then the function <span class="math">\(f\)</span> defined by
<span class="math">\(f (x) = g(U(x))\)</span> is convex.</li>
</ol>
<p>Many more technical details about convexity and convex optimization can
be found in this <a class="reference external" href="http://web.stanford.edu/~boyd/cvxbook/">book</a>.</p>
</div>
</div>
<div class="section" id="are-there-any-constraints-that-the-solution-must-meet">
<h3>Are there any constraints that the solution must meet?<a class="headerlink" href="#are-there-any-constraints-that-the-solution-must-meet" title="Permalink to this headline">¶</a></h3>
<p>In general, optimization without constraints is easier to perform than
optimization in the presence of constraints. The solutions may be very
different in the presence or absence of constraints, so it is important
to know if there are any constraints.</p>
<p>We will see some examples of two general strategies: - convert a problem
with constraints into one without constraints or - use an algorithm that
can optimize with constraints.</p>
</div>
</div>
<div class="section" id="using-scipy-optimize">
<h2>Using <code class="docutils literal"><span class="pre">scipy.optimize</span></code><a class="headerlink" href="#using-scipy-optimize" title="Permalink to this headline">¶</a></h2>
<p>One of the most convenient libraries to use is <code class="docutils literal"><span class="pre">scipy.optimize</span></code>, since
it is already part of the Anaconda installation and it has a fairly
intuitive interface.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">optimize</span> <span class="k">as</span> <span class="n">opt</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">15</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_59_0.png" src="_images/14C_Optimization_In_Python_59_0.png" />
<p>The
<code class="docutils literal"><span class="pre">`minimize_scalar</span></code> &lt;<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize_scalar.html#scipy.optimize.minimize_scalar">http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize_scalar.html#scipy.optimize.minimize_scalar</a>&gt;`__
function will find the minimum, and can also be told to search within
given bounds. By default, it uses the Brent algorithm, which combines a
bracketing strategy with a parabolic approximation.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Brent&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">fun</span><span class="p">:</span> <span class="o">-</span><span class="mf">803.39553088258845</span>
   <span class="n">nfev</span><span class="p">:</span> <span class="mi">12</span>
    <span class="n">nit</span><span class="p">:</span> <span class="mi">11</span>
<span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.5288011252196627</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bounded&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">fun</span><span class="p">:</span> <span class="o">-</span><span class="mf">54.210039377127622</span>
<span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Solution found.&#39;</span>
   <span class="n">nfev</span><span class="p">:</span> <span class="mi">12</span>
 <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">x</span><span class="p">:</span> <span class="mf">2.6688651040396532</span>
</pre></div>
</div>
<div class="section" id="local-and-global-minima">
<h3>Local and global minima<a class="headerlink" href="#local-and-global-minima" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">offset</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_65_0.png" src="_images/14C_Optimization_In_Python_65_0.png" />
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># note how additional function arguments are passed in</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,))</span>
<span class="n">sol</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">fun</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.049029624014074166</span>
   <span class="n">nfev</span><span class="p">:</span> <span class="mi">11</span>
    <span class="n">nit</span><span class="p">:</span> <span class="mi">10</span>
<span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.4843871263953001</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_67_0.png" src="_images/14C_Optimization_In_Python_67_0.png" />
<div class="section" id="we-can-try-multiple-random-starts-to-find-the-global-minimum">
<h4>We can try multiple random starts to find the global minimum<a class="headerlink" href="#we-can-try-multiple-random-starts-to-find-the-global-minimum" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">sols</span> <span class="o">=</span> <span class="p">[</span><span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,),</span> <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">u</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">([</span><span class="n">sol</span><span class="o">.</span><span class="n">fun</span> <span class="k">for</span> <span class="n">sol</span> <span class="ow">in</span> <span class="n">sols</span><span class="p">])</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">sols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_71_0.png" src="_images/14C_Optimization_In_Python_71_0.png" />
</div>
<div class="section" id="using-a-stochastic-algorithm">
<h4>Using a stochastic algorithm<a class="headerlink" href="#using-a-stochastic-algorithm" title="Permalink to this headline">¶</a></h4>
<p>See documentation for the
<code class="docutils literal"><span class="pre">`basinhopping</span></code> &lt;<a class="reference external" href="http://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.optimize.basinhopping.html">http://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.optimize.basinhopping.html</a>&gt;`__
algorithm, which also works with multivariate scalar optimization. Note
that this is heuristic and not guaranteed to find a global minimum.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">basinhopping</span>

<span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">basinhopping</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimizer_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,)})</span>
<span class="n">sol</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>                       <span class="n">fun</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">lowest_optimization_result</span><span class="p">:</span>       <span class="n">fun</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">hess_inv</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span> <span class="mf">0.304</span><span class="p">]])</span>
     <span class="n">jac</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.</span><span class="p">])</span>
 <span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Optimization terminated successfully.&#39;</span>
    <span class="n">nfev</span><span class="p">:</span> <span class="mi">15</span>
     <span class="n">nit</span><span class="p">:</span> <span class="mi">3</span>
    <span class="n">njev</span><span class="p">:</span> <span class="mi">5</span>
  <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
 <span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
       <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">5.</span><span class="p">])</span>
                   <span class="n">message</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;requested number of basinhopping iterations completed successfully&#39;</span><span class="p">]</span>
     <span class="n">minimization_failures</span><span class="p">:</span> <span class="mi">0</span>
                      <span class="n">nfev</span><span class="p">:</span> <span class="mi">1848</span>
                       <span class="n">nit</span><span class="p">:</span> <span class="mi">100</span>
                      <span class="n">njev</span><span class="p">:</span> <span class="mi">616</span>
                         <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">5.</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_74_0.png" src="_images/14C_Optimization_In_Python_74_0.png" />
</div>
<div class="section" id="minimizing-a-multivariate-function">
<h4>Minimizing a multivariate function <span class="math">\(f: \mathbb{R}^n \rightarrow \mathbb{R}\)</span><a class="headerlink" href="#minimizing-a-multivariate-function" title="Permalink to this headline">¶</a></h4>
<p>We will next move on to optimization of multivariate scalar functions,
where the scalar may (say) be the norm of a vector. Minimizing a
multivariable set of equations
<span class="math">\(f: \mathbb{R}^n \rightarrow \mathbb{R}^n\)</span> is not well-defined,
but we will later see how to solve the closely related problem of
finding roots or fixed points of such a set of equations.</p>
<p>We will use the <a class="reference external" href="http://en.wikipedia.org/wiki/Rosenbrock_function">Rosenbrock &#8220;banana&#8221;
function</a> to
illustrate unconstrained multivariate optimization. In 2D, this is</p>
<div class="math">
\[f(x, y) = b(y - x^2)^2 + (a - x)^2\]</div>
<p>The function has a global minimum at (1,1) and the standard expression
takes <span class="math">\(a = 1\)</span> and <span class="math">\(b = 100\)</span>.</p>
</div>
<div class="section" id="conditioning-of-optimization-problem">
<h4>Conditioning of optimization problem<a class="headerlink" href="#conditioning-of-optimization-problem" title="Permalink to this headline">¶</a></h4>
<p>With these values for <span class="math">\(a\)</span> and <span class="math">\(b\)</span>, the problem is
ill-conditioned. As we shall see, one of the factors affecting the ease
of optimization is the condition number of the curvature (Hessian). When
the condition number is high, the gradient may not point in the
direction of the minimum, and simple gradient descent methods may be
inefficient since they may be forced to take many sharp turns.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">hessian</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">N</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x y&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">Function</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">hessian</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
<span class="n">H</span><span class="p">,</span> <span class="n">N</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">condition_number</span><span class="p">())</span>
</pre></div>
</div>
<div class="math">
\[\begin{split}\left ( \left[\begin{matrix}802 &amp; -400\\-400 &amp; 200\end{matrix}\right], \quad 2508.00960127744\right )\end{split}\]</div>
</div>
<div class="section" id="as-pointed-out-in-the-previous-lecture-the-condition-number-is-basically-the-ratio-of-largest-to-smallest-eigenvalue-of-the-hessian">
<h4>As pointed out in the previous lecture, the condition number is basically the ratio of largest to smallest eigenvalue of the Hessian<a class="headerlink" href="#as-pointed-out-in-the-previous-lecture-the-condition-number-is-basically-the-ratio-of-largest-to-smallest-eigenvalue-of-the-hessian" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="k">as</span> <span class="nn">la</span>

<span class="n">mu</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">802</span><span class="p">,</span> <span class="o">-</span><span class="mi">400</span><span class="p">,</span> <span class="o">-</span><span class="mi">400</span><span class="p">,</span> <span class="mi">200</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">np</span><span class="o">.</span><span class="n">real_if_close</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">mu</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">(</span><span class="mf">2508.009601277337</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rosen</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generalized n-dimensional version of the Rosenbrock function&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="why-is-the-condition-number-so-large">
<h4>Why is the condition number so large?<a class="headerlink" href="#why-is-the-condition-number-so-large" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">rosen</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Note: the global minimum is at (1,1) in a tiny contour island</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_83_0.png" src="_images/14C_Optimization_In_Python_83_0.png" />
</div>
<div class="section" id="zooming-in-to-the-global-minimum-at-1-1">
<h4>Zooming in to the global minimum at (1,1)<a class="headerlink" href="#zooming-in-to-the-global-minimum-at-1-1" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">rosen</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="p">[</span><span class="n">rosen</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">]))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_86_0.png" src="_images/14C_Optimization_In_Python_86_0.png" />
</div>
</div>
</div>
<div class="section" id="gradient-descent">
<h2>Gradient descent<a class="headerlink" href="#gradient-descent" title="Permalink to this headline">¶</a></h2>
<p>The gradient (or Jacobian) at a point indicates the direction of
steepest ascent. Since we are looking for a minimum, one obvious
possibility is to take a step in the opposite direction to the gradient.
We weight the size of the step by a factor <span class="math">\(\alpha\)</span> known in the
machine learning literature as the learning rate. If <span class="math">\(\alpha\)</span> is
small, the algorithm will eventually converge towards a local minimum,
but it may take long time. If <span class="math">\(\alpha\)</span> is large, the algorithm may
converge faster, but it may also overshoot and never find the minimum.
Gradient descent is also known as a first order method because it
requires calculation of the first derivative at each iteration.</p>
<p>Some algorithms also determine the appropriate value of <span class="math">\(\alpha\)</span>
at each stage by using a line search, i.e.,</p>
<div class="math">
\[\alpha^* = \arg\min_\alpha f(x_k - \alpha \nabla{f(x_k)})\]</div>
<p>which is a 1D optimization problem.</p>
<p>As suggested above, the problem is that the gradient may not point
towards the global minimum especially when the condition number is
large, and we are forced to use a small <span class="math">\(\alpha\)</span> for convergence.</p>
<p>Let&#8217;s warm up by minimizing a trivial function
<span class="math">\(f(x, y) = x^2 + y^2\)</span> to illustrate the basic idea of gradient
descent.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">a</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># learning rate</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">41</span><span class="p">):</span>
    <span class="n">x0</span> <span class="o">-=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">grad</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Start</span> <span class="p">[</span> <span class="mf">1.</span>  <span class="mf">1.</span><span class="p">]</span>
<span class="mi">0</span> <span class="p">[</span> <span class="mf">0.8</span>  <span class="mf">0.8</span><span class="p">]</span>
<span class="mi">5</span> <span class="p">[</span> <span class="mf">0.262</span>  <span class="mf">0.262</span><span class="p">]</span>
<span class="mi">10</span> <span class="p">[</span> <span class="mf">0.086</span>  <span class="mf">0.086</span><span class="p">]</span>
<span class="mi">15</span> <span class="p">[</span> <span class="mf">0.028</span>  <span class="mf">0.028</span><span class="p">]</span>
<span class="mi">20</span> <span class="p">[</span> <span class="mf">0.009</span>  <span class="mf">0.009</span><span class="p">]</span>
<span class="mi">25</span> <span class="p">[</span> <span class="mf">0.003</span>  <span class="mf">0.003</span><span class="p">]</span>
<span class="mi">30</span> <span class="p">[</span> <span class="mf">0.001</span>  <span class="mf">0.001</span><span class="p">]</span>
<span class="mi">35</span> <span class="p">[</span> <span class="mf">0.</span>  <span class="mf">0.</span><span class="p">]</span>
<span class="mi">40</span> <span class="p">[</span> <span class="mf">0.</span>  <span class="mf">0.</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="gradient-descent-for-least-squares-minimization">
<h3>Gradient descent for least squares minimization<a class="headerlink" href="#gradient-descent-for-least-squares-minimization" title="Permalink to this headline">¶</a></h3>
<p>Usually, when we optimize, we are not just finding the minimum, but also
want to know the parameters that give us the minimum. As a simple
example, suppose we want to find parameters that minimize the least
squares difference between a linear model and some data. Suppose we have
some data <span class="math">\((0,1), (1,2), (2,3), (3,3.5), (4,6), (5,9), (6,8)\)</span> and
want to find a line <span class="math">\(y = \beta_0 +\beta_1 x\)</span> that is the best
least squares fit. One way to do this is to solve
<span class="math">\(X^TX\hat{\beta} = X^Ty\)</span>, but we want to show how this can be
formulated as a gradient descent problem.</p>
<p>We want to find <span class="math">\(\beta = (\beta_0, \beta_1)\)</span> that minimize the
squared differences</p>
<div class="math">
\[r = \sum(\beta_0 + \beta_1 x - y)^2\]</div>
<p>We calculate the gradient with respect to <span class="math">\(\beta\)</span> as</p>
<div class="math">
\[\begin{split}\nabla r = \pmatrix{ \frac{\delta r}{\delta \beta_0} \\ \frac{\delta r}{\delta \beta_0}}\end{split}\]</div>
<p>and apply gradient descent.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gradient of objective function with respect to parameters b.&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="nb">sum</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">b</span><span class="p">)),</span>
            <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="nb">zip</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mf">3.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">)))</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># learning rate</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">-=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">grad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">b</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span> <span class="mf">0.571</span><span class="p">,</span>  <span class="mf">1.357</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_94_0.png" src="_images/14C_Optimization_In_Python_94_0.png" />
</div>
<div class="section" id="gradient-descent-to-minimize-the-rosen-function-using-scipy-optimize">
<h3>Gradient descent to minimize the Rosen function using <code class="docutils literal"><span class="pre">scipy.optimize</span></code><a class="headerlink" href="#gradient-descent-to-minimize-the-rosen-function-using-scipy-optimize" title="Permalink to this headline">¶</a></h3>
<p>Because gradient descent is unreliable in practice, it is not part of
the <code class="docutils literal"><span class="pre">scipy</span></code> optimize suite of functions, but we will write a custom
function below to illustrate how to use gradient descent while
maintaining the <code class="docutils literal"><span class="pre">scipy.optimize</span></code> interface.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rosen_der</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Derivative of generalized Rosen function.&quot;&quot;&quot;</span>
    <span class="n">xm</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xm_m1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">xm_p1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">der</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">der</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="o">*</span><span class="p">(</span><span class="n">xm</span><span class="o">-</span><span class="n">xm_m1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">400</span><span class="o">*</span><span class="p">(</span><span class="n">xm_p1</span> <span class="o">-</span> <span class="n">xm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">xm</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">xm</span><span class="p">)</span>
    <span class="n">der</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">der</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">der</span>
</pre></div>
</div>
<p><strong>Warning</strong> One of the most common causes of failure of optimization is
because the gradient or Hessian function is specified incorrectly. You
can check for this using <code class="docutils literal"><span class="pre">check_grad</span></code> which compares the analytical
gradient with one calculated using finite differences.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">check_grad</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">check_grad</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_der</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">-</span><span class="mf">1.002</span>  <span class="mf">0.488</span><span class="p">]</span> <span class="mf">7.76924856764e-06</span>
<span class="p">[</span><span class="o">-</span><span class="mf">0.54</span>   <span class="mf">0.625</span><span class="p">]</span> <span class="mf">1.78115499411e-06</span>
<span class="p">[</span> <span class="mf">0.159</span>  <span class="mf">0.203</span><span class="p">]</span> <span class="mf">1.55391738656e-06</span>
<span class="p">[</span> <span class="mf">1.542</span>  <span class="mf">0.689</span><span class="p">]</span> <span class="mf">1.16032403535e-05</span>
<span class="p">[</span> <span class="mf">1.333</span> <span class="o">-</span><span class="mf">1.931</span><span class="p">]</span> <span class="mf">3.09846435193e-05</span>
<span class="p">[</span> <span class="mf">0.808</span>  <span class="mf">0.92</span> <span class="p">]</span> <span class="mf">3.14878094308e-06</span>
<span class="p">[</span> <span class="mf">1.149</span>  <span class="mf">1.416</span><span class="p">]</span> <span class="mf">7.78932772449e-06</span>
<span class="p">[</span> <span class="mf">1.767</span>  <span class="mf">1.172</span><span class="p">]</span> <span class="mf">2.73491380503e-05</span>
<span class="p">[</span> <span class="mf">0.452</span> <span class="o">-</span><span class="mf">1.621</span><span class="p">]</span> <span class="mf">5.25282739165e-06</span>
<span class="p">[</span><span class="o">-</span><span class="mf">1.627</span>  <span class="mf">1.048</span><span class="p">]</span> <span class="mf">1.89059712929e-05</span>
</pre></div>
</div>
<div class="section" id="writing-a-custom-function-for-the-scipy-optimize-interface">
<h4>Writing a custom function for the <code class="docutils literal"><span class="pre">scipy.optimize</span></code> interface.<a class="headerlink" href="#writing-a-custom-function-for-the-scipy-optimize-interface" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">custmin</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">maxfev</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">,</span>
        <span class="n">maxiter</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implements simple gradient descent for the Rosen function.&quot;&quot;&quot;</span>
    <span class="n">bestx</span> <span class="o">=</span> <span class="n">x0</span>
    <span class="n">bestf</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">funcalls</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">niter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">improved</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">while</span> <span class="n">improved</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stop</span> <span class="ow">and</span> <span class="n">niter</span> <span class="o">&lt;</span> <span class="n">maxiter</span><span class="p">:</span>
        <span class="n">niter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># the next 2 lines are gradient descent</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">rosen_der</span><span class="p">(</span><span class="n">bestx</span><span class="p">)</span>
        <span class="n">bestx</span> <span class="o">=</span> <span class="n">bestx</span> <span class="o">-</span> <span class="n">step</span>

        <span class="n">bestf</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">bestx</span><span class="p">)</span>
        <span class="n">funcalls</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">improved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">(</span><span class="n">bestx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maxfev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">funcalls</span> <span class="o">&gt;=</span> <span class="n">maxfev</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">opt</span><span class="o">.</span><span class="n">OptimizeResult</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="n">bestf</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">bestx</span><span class="p">,</span> <span class="n">nit</span><span class="o">=</span><span class="n">niter</span><span class="p">,</span>
                              <span class="n">nfev</span><span class="o">=</span><span class="n">funcalls</span><span class="p">,</span> <span class="n">success</span><span class="o">=</span><span class="p">(</span><span class="n">niter</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reporter</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reporter function to capture intermediate states of optimization.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">ps</span>
    <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Initial starting position</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mf">4.1</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
<span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">custmin</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">reporter</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">fun</span><span class="p">:</span> <span class="mf">1.0604663473448339e-08</span>
   <span class="n">nfev</span><span class="p">:</span> <span class="mi">100001</span>
    <span class="n">nit</span><span class="p">:</span> <span class="mi">100000</span>
<span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">rosen</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ps</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ps</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)),</span> <span class="n">rosen</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">T</span><span class="p">));</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_105_0.png" src="_images/14C_Optimization_In_Python_105_0.png" />
</div>
</div>
<div class="section" id="newton-s-method-and-variants">
<h3>Newton&#8217;s method and variants<a class="headerlink" href="#newton-s-method-and-variants" title="Permalink to this headline">¶</a></h3>
<p>Recall Newton&#8217;s method for finding roots of a univariate function</p>
<div class="math">
\[x_{K+1} = x_k - \frac{f(x_k)}{f'(x_k)}\]</div>
<p>When we are looking for a minimum, we are looking for the roots of the
<em>derivative</em> <span class="math">\(f'(x)\)</span>, so</p>
<div class="math">
\[x_{K+1} = x_k - \frac{f'(x_k}{f''(x_k)}\]</div>
<p>Newton&#8217;s method can also be seen as a Taylor series approximation</p>
<div class="math">
\[f(x+h) = f(x) + h f'(x) + \frac{h^2}{2}f''(x)\]</div>
<p>At the function minimum, the derivative is 0, so</p>
<p>and letting <span class="math">\(\Delta x = \frac{h}{2}\)</span>, we get that the Newton step
is</p>
<div class="math">
\[\Delta x = - \frac{f'(x)}{f''(x)}\]</div>
<p>The multivariate analog replaces <span class="math">\(f'\)</span> with the Jacobian and
<span class="math">\(f''\)</span> with the Hessian, so the Newton step is</p>
<div class="math">
\[\Delta x = -H^{-1}(x) \nabla f(x)\]</div>
<div class="section" id="second-order-methods">
<h4>Second order methods<a class="headerlink" href="#second-order-methods" title="Permalink to this headline">¶</a></h4>
<p>Second order methods solve for <span class="math">\(H^{-1}\)</span> and so require calculation
of the Hessian (either provided or approximated using finite
differences). For efficiency reasons, the Hessian is not directly
inverted, but solved for using a variety of methods such as conjugate
gradient. An example of a second order method in the <code class="docutils literal"><span class="pre">optimize</span></code>
package is <code class="docutils literal"><span class="pre">Newton-GC</span></code>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">rosen</span><span class="p">,</span> <span class="n">rosen_der</span><span class="p">,</span> <span class="n">rosen_hess</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
<span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Newton-CG&#39;</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">rosen_der</span><span class="p">,</span> <span class="n">hess</span><span class="o">=</span><span class="n">rosen_hess</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">reporter</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">fun</span><span class="p">:</span> <span class="mf">1.3642782750354208e-13</span>
    <span class="n">jac</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span><span class="p">])</span>
<span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Optimization terminated successfully.&#39;</span>
   <span class="n">nfev</span><span class="p">:</span> <span class="mi">38</span>
   <span class="n">nhev</span><span class="p">:</span> <span class="mi">26</span>
    <span class="n">nit</span><span class="p">:</span> <span class="mi">26</span>
   <span class="n">njev</span><span class="p">:</span> <span class="mi">63</span>
 <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ps</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ps</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)),</span> <span class="n">rosen</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">T</span><span class="p">));</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_110_0.png" src="_images/14C_Optimization_In_Python_110_0.png" />
</div>
<div class="section" id="first-order-methods">
<h4>First order methods<a class="headerlink" href="#first-order-methods" title="Permalink to this headline">¶</a></h4>
<p>As calculating the Hessian is computationally expensive, sometimes first
order methods that only use the first derivatives are preferred.
Quasi-Newton methods use functions of the first derivatives to
approximate the inverse Hessian. A well know example of the
Quasi-Newoton class of algorithjms is BFGS, named after the initials of
the creators. As usual, the first derivatives can either be provided via
the <code class="docutils literal"><span class="pre">jac=</span></code> argument or approximated by finite difference methods.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
<span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;BFGS&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">reporter</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>     <span class="n">fun</span><span class="p">:</span> <span class="mf">9.48988612333806e-12</span>
<span class="n">hess_inv</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span> <span class="mf">0.5</span>  <span class="p">,</span>  <span class="mf">1.</span>   <span class="p">],</span>
      <span class="p">[</span> <span class="mf">1.</span>   <span class="p">,</span>  <span class="mf">2.005</span><span class="p">]])</span>
     <span class="n">jac</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span><span class="p">])</span>
 <span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Desired error not necessarily achieved due to precision loss.&#39;</span>
    <span class="n">nfev</span><span class="p">:</span> <span class="mi">540</span>
     <span class="n">nit</span><span class="p">:</span> <span class="mi">56</span>
    <span class="n">njev</span><span class="p">:</span> <span class="mi">132</span>
  <span class="n">status</span><span class="p">:</span> <span class="mi">2</span>
 <span class="n">success</span><span class="p">:</span> <span class="kc">False</span>
       <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ps</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ps</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)),</span> <span class="n">rosen</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">T</span><span class="p">));</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_113_0.png" src="_images/14C_Optimization_In_Python_113_0.png" />
</div>
<div class="section" id="zeroth-order-methods">
<h4>Zeroth order methods<a class="headerlink" href="#zeroth-order-methods" title="Permalink to this headline">¶</a></h4>
<p>Finally, there are some optimization algorithms not based on the Newton
method, but on other heuristic search strategies that do not require any
derivatives, only function evaluations. One well-known example is the
Nelder-Mead simplex algorithm.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
<span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">rosen</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nelder-mead&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">reporter</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">final_simplex</span><span class="p">:</span> <span class="p">(</span><span class="n">array</span><span class="p">([[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
      <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span>
      <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">]]),</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">]))</span>
          <span class="n">fun</span><span class="p">:</span> <span class="mf">5.262756878429089e-10</span>
      <span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Optimization terminated successfully.&#39;</span>
         <span class="n">nfev</span><span class="p">:</span> <span class="mi">162</span>
          <span class="n">nit</span><span class="p">:</span> <span class="mi">85</span>
       <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
      <span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
            <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ps</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ps</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)),</span> <span class="n">rosen</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">T</span><span class="p">));</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_116_0.png" src="_images/14C_Optimization_In_Python_116_0.png" />
</div>
</div>
<div class="section" id="lagrange-multipliers-and-constrained-optimization">
<h3>Lagrange multipliers and constrained optimization<a class="headerlink" href="#lagrange-multipliers-and-constrained-optimization" title="Permalink to this headline">¶</a></h3>
<p>Recall why Lagrange multipliers are useful for constrained optimization
- a stationary point must be where the constraint surface <span class="math">\(g\)</span>
touches a level set of the function <span class="math">\(f\)</span> (since the value of
<span class="math">\(f\)</span> does not change on a level set). At that point, <span class="math">\(f\)</span> and
<span class="math">\(g\)</span> are parallel, and hence their gradients are also parallel
(since the gradient is normal to the level set). So we want to solve</p>
<div class="math">
\[\nabla f = -\lambda \nabla g\]</div>
<p>or equivalently,</p>
<div class="math">
\[\nabla f + \lambda \nabla g = 0\]</div>
<div class="figure" id="id1">
<img alt="Lagrange multipliers" src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/LagrangeMultipliers2D.svg/300px-LagrangeMultipliers2D.svg.png" />
<p class="caption"><span class="caption-text">Lagrange multipliers</span></p>
</div>
<div class="section" id="numerical-example-of-using-lagrange-multipliers">
<h4>Numerical example of using Lagrange multipliers<a class="headerlink" href="#numerical-example-of-using-lagrange-multipliers" title="Permalink to this headline">¶</a></h4>
<p>Maximize <span class="math">\(f (x, y, z) = xy + yz\)</span> subject to the constraints
<span class="math">\(x + 2y = 6\)</span> and <span class="math">\(x − 3z = 0\)</span>.</p>
<p>We set up the equations</p>
<div class="math">
\[F (x, y, z, λ, μ) = xy + yz − λ(x + 2y − 6) − μ(x − 3z)\]</div>
<p>Now set partial derivatives to zero and solve the following set of
equations</p>
<p>which is a linear equation in <span class="math">\(x, y, z, \lambda, \mu\)</span></p>
<div class="math">
\[\begin{split}\begin{pmatrix}
0 &amp; 1 &amp; 0 &amp; -1 &amp; -1 \\
1 &amp; 0 &amp; 1 &amp; -2 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 3 \\
1 &amp; 2 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; -3 &amp; 0 &amp; 0 \\
\end{pmatrix}\pmatrix{x \\ y \\ z \\ \lambda \\ \mu} = \pmatrix{0 \\ 0 \\ 0 \\ 6 \\ 0}\end{split}\]</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">sol</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span> <span class="mf">3.</span> <span class="p">,</span>  <span class="mf">1.5</span><span class="p">,</span>  <span class="mf">1.</span> <span class="p">,</span>  <span class="mf">2.</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">z</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">sol</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<div class="math">
\[6.0\]</div>
</div>
</div>
<div class="section" id="check-using-scipy-optimize">
<h3>Check using <code class="docutils literal"><span class="pre">scipy.optimize</span></code><a class="headerlink" href="#check-using-scipy-optimize" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Convert to minimization problem by negating function</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">cons</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
         <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">6</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]])})</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.67</span><span class="p">])</span>
<span class="n">cx</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
<span class="n">cx</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">fun</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.9999999999999689</span>
    <span class="n">jac</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.</span> <span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span>  <span class="mf">0.</span> <span class="p">])</span>
<span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Optimization terminated successfully.&#39;</span>
   <span class="n">nfev</span><span class="p">:</span> <span class="mi">15</span>
    <span class="n">nit</span><span class="p">:</span> <span class="mi">3</span>
   <span class="n">njev</span><span class="p">:</span> <span class="mi">3</span>
 <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">3.</span> <span class="p">,</span>  <span class="mf">1.5</span><span class="p">,</span>  <span class="mf">1.</span> <span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="another-example-of-constrained-optimization">
<h3>Another example of constrained optimization<a class="headerlink" href="#another-example-of-constrained-optimization" title="Permalink to this headline">¶</a></h3>
<p>Many real-world optimization problems have constraints - for example, a
set of parameters may have to sum to 1.0 (equality constraint), or some
parameters may have to be non-negative (inequality constraint).
Sometimes, the constraints can be incorporated into the function to be
minimized, for example, the non-negativity constraint <span class="math">\(p \gt 0\)</span>
can be removed by substituting <span class="math">\(p = e^q\)</span> and optimizing for
<span class="math">\(q\)</span>. Using such workarounds, it may be possible to convert a
constrained optimization problem into an unconstrained one, and use the
methods discussed above to solve the problem.</p>
<p>Alternatively, we can use optimization methods that allow the
specification of constraints directly in the problem statement as shown
in this section. Internally, constraint violation penalties, barriers
and Lagrange multipliers are some of the methods used used to handle
these constraints. We use the example provided in the Scipy
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html">tutorial</a>
to illustrate how to set constraints.</p>
<p>We will optimize:</p>
<div class="math">
\[f(x) = -(2xy + 2x - x^2 -2y^2)\]</div>
<p>subject to the constraint</p>
<div class="math">
\[ \begin{align}\begin{aligned}\begin{split}  x^3 - y = 0 \\
  y - (x-1)^4 - 2 \ge 0\end{split}\\and the bounds\end{aligned}\end{align} \]</div>
<div class="math">
\[\begin{split}0.5 \le x \le 1.5 \\
1.5 \le y \le 2.5\end{split}\]</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.99</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<div class="math">
\[\left [ 0, \quad 3, \quad 0, \quad 3\right ]\]</div>
<img alt="_images/14C_Optimization_In_Python_130_1.png" src="_images/14C_Optimization_In_Python_130_1.png" />
<p>To set constraints, we pass in a dictionary with keys <code class="docutils literal"><span class="pre">type</span></code>, <code class="docutils literal"><span class="pre">fun</span></code>
and <code class="docutils literal"><span class="pre">jac</span></code>. Note that the inequality constraint assumes a
<span class="math">\(C_j x \ge 0\)</span> form. As usual, the <code class="docutils literal"><span class="pre">jac</span></code> is optional and will be
numerically estimated if not provided.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">cons</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
         <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span>
         <span class="s1">&#39;jac&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span><span class="p">),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])},</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span>
         <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])})</span>

<span class="n">bnds</span> <span class="o">=</span> <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]</span>
</pre></div>
</div>
<p>Unconstrained optimization</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ux</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ux</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>     <span class="n">fun</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.9999999999996365</span>
<span class="n">hess_inv</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span> <span class="mf">0.998</span><span class="p">,</span>  <span class="mf">0.501</span><span class="p">],</span>
      <span class="p">[</span> <span class="mf">0.501</span><span class="p">,</span>  <span class="mf">0.499</span><span class="p">]])</span>
     <span class="n">jac</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span><span class="p">])</span>
 <span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Optimization terminated successfully.&#39;</span>
    <span class="n">nfev</span><span class="p">:</span> <span class="mi">24</span>
     <span class="n">nit</span><span class="p">:</span> <span class="mi">5</span>
    <span class="n">njev</span><span class="p">:</span> <span class="mi">6</span>
  <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
 <span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
       <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">2.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">])</span>
</pre></div>
</div>
<p>Constrained optimization</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">cx</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
<span class="n">cx</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">fun</span><span class="p">:</span> <span class="mf">2.0499154720910759</span>
    <span class="n">jac</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">3.487</span><span class="p">,</span>  <span class="mf">5.497</span><span class="p">,</span>  <span class="mf">0.</span>   <span class="p">])</span>
<span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Optimization terminated successfully.&#39;</span>
   <span class="n">nfev</span><span class="p">:</span> <span class="mi">21</span>
    <span class="n">nit</span><span class="p">:</span> <span class="mi">5</span>
   <span class="n">njev</span><span class="p">:</span> <span class="mi">5</span>
 <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">1.261</span><span class="p">,</span>  <span class="mf">2.005</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.99</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ux</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ux</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">cx</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">cx</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_138_0.png" src="_images/14C_Optimization_In_Python_138_0.png" />
</div>
<div class="section" id="some-applications-of-optimization">
<h3>Some applications of optimization<a class="headerlink" href="#some-applications-of-optimization" title="Permalink to this headline">¶</a></h3>
<div class="section" id="curve-fitting">
<h4>Curve fitting<a class="headerlink" href="#curve-fitting" title="Permalink to this headline">¶</a></h4>
<p>Sometimes, we simply want to use non-linear least squares to fit a
function to data, perhaps to estimate parameters for a mechanistic or
phenomenological model. The <code class="docutils literal"><span class="pre">curve_fit</span></code> function uses the quasi-Newton
Levenberg-Marquadt algorithm to perform such fits. Behind the scenes,
<code class="docutils literal"><span class="pre">curve_fit</span></code> is just a wrapper around the <code class="docutils literal"><span class="pre">leastsq</span></code> function that
does nonlinear least squares fitting.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">curve_fit</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">logistic4</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The four paramter logistic function is often used to fit dose-response relationships.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">a</span><span class="o">-</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="p">((</span><span class="n">x</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="n">b</span><span class="p">)))</span> <span class="o">+</span> <span class="n">d</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">nobs</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="n">nobs</span><span class="p">)</span>
<span class="n">ptrue</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<span class="n">ydata</span> <span class="o">=</span> <span class="n">logistic4</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="o">*</span><span class="n">ptrue</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nobs</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">logistic4</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">perr</span> <span class="o">=</span> <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Param</span><span class="se">\t</span><span class="s1">True</span><span class="se">\t</span><span class="s1">Estim (+/- 1 SD)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">pe</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">,</span> <span class="n">ptrue</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">perr</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%5.2f</span><span class="se">\t</span><span class="si">%5.2f</span><span class="s1"> (+/-</span><span class="si">%5.2f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">pe</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Param</span>       <span class="kc">True</span>    <span class="n">Estim</span> <span class="p">(</span><span class="o">+/-</span> <span class="mi">1</span> <span class="n">SD</span><span class="p">)</span>
<span class="n">a</span>   <span class="mf">10.00</span>   <span class="mf">10.35</span> <span class="p">(</span><span class="o">+/-</span> <span class="mf">0.19</span><span class="p">)</span>
<span class="n">b</span>    <span class="mf">3.00</span>    <span class="mf">2.71</span> <span class="p">(</span><span class="o">+/-</span> <span class="mf">0.92</span><span class="p">)</span>
<span class="n">c</span>    <span class="mf">1.50</span>    <span class="mf">1.61</span> <span class="p">(</span><span class="o">+/-</span> <span class="mf">0.16</span><span class="p">)</span>
<span class="n">d</span>   <span class="mf">12.00</span>   <span class="mf">12.34</span> <span class="p">(</span><span class="o">+/-</span> <span class="mf">0.27</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">logistic4</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_146_0.png" src="_images/14C_Optimization_In_Python_146_0.png" />
</div>
</div>
<div class="section" id="finding-paraemeters-for-ode-models">
<h3>Finding paraemeters for ODE models<a class="headerlink" href="#finding-paraemeters-for-ode-models" title="Permalink to this headline">¶</a></h3>
<p>This is a specialized application of <code class="docutils literal"><span class="pre">curve_fit</span></code>, in which the curve
to be fitted is defined implicitly by an ordinary differential equation</p>
<div class="math">
\[\frac{dx}{dt} = -kx\]</div>
<p>and we want to use observed data to estimate the parameters <span class="math">\(k\)</span>
and the initial value <span class="math">\(x_0\)</span>. Of course this can be explicitly
solved but the same approach can be used to find multiple parameters for
<span class="math">\(n\)</span>-dimensional systems of ODEs.</p>
<p><a class="reference external" href="http://adventuresinpython.blogspot.com/2012/08/fitting-differential-equation-system-to.html">A more elaborate example for fitting a system of ODEs to model the
zombie
apocalypse</a></p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">odeint</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple exponential decay.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span>

<span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solution to the ODE x&#39;(t) = f(t,x,k) with initial condition x(0) = x0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># True parameter values</span>
<span class="n">x0_</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">k_</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="c1"># Some random data genererated from closed form solution plus Gaussian noise</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">x0_</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k_</span><span class="o">*</span><span class="n">ts</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>

<span class="n">popt</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>
<span class="n">k_opt</span><span class="p">,</span> <span class="n">x0_opt</span> <span class="o">=</span> <span class="n">popt</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k = </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">k_opt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x0 = </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x0_opt</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mf">0.313527</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">9.97788</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k_opt</span><span class="p">,</span> <span class="n">x0_opt</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_150_0.png" src="_images/14C_Optimization_In_Python_150_0.png" />
</div>
<div class="section" id="another-example-of-fitting-a-system-of-odes-using-the-lmfit-package">
<h3>Another example of fitting a system of ODEs using the <code class="docutils literal"><span class="pre">lmfit</span></code> package<a class="headerlink" href="#another-example-of-fitting-a-system-of-odes-using-the-lmfit-package" title="Permalink to this headline">¶</a></h3>
<p>You may have to install the
<code class="docutils literal"><span class="pre">`lmfit</span></code> &lt;<a class="reference external" href="http://cars9.uchicago.edu/software/python/lmfit/index.html">http://cars9.uchicago.edu/software/python/lmfit/index.html</a>&gt;`__
package using <code class="docutils literal"><span class="pre">pip</span></code> and restart your kernel. The <code class="docutils literal"><span class="pre">lmfit</span></code> algorithm
is another wrapper around <code class="docutils literal"><span class="pre">scipy.optimize.leastsq</span></code> but allows for
richer model specification and more diagnostics.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span>! pip install lmfit
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>Requirement already satisfied (use --upgrade to upgrade): lmfit in /opt/conda/lib/python3.5/site-packages
Requirement already satisfied (use --upgrade to upgrade): scipy in /opt/conda/lib/python3.5/site-packages (from lmfit)
Requirement already satisfied (use --upgrade to upgrade): numpy in /opt/conda/lib/python3.5/site-packages (from lmfit)
[33mYou are using pip version 8.1.2, however version 9.0.1 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.[0m
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lmfit</span> <span class="k">import</span> <span class="n">minimize</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">report_fit</span>
<span class="kn">import</span> <span class="nn">warnings</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Lotka-Volterra predator-prey model.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">ps</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xs</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">d</span><span class="o">*</span><span class="n">y</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">ps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solution to the ODE x&#39;(t) = f(t,x,k) with initial condition x(0) = x0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ps</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">ps</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">model</span> <span class="o">-</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<span class="n">true_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">true_params</span><span class="p">)</span>
<span class="n">data</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># set parameters incluing bounds</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
<span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;y0&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># fit model and find predicted values</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;leastsq&#39;</span><span class="p">)</span>
<span class="n">final</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">residual</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># plot data and fitted curves</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>

<span class="c1"># display fitted statistics</span>
<span class="n">report_fit</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">ipykernel</span><span class="o">/</span><span class="n">__main__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span> <span class="n">VisibleDeprecationWarning</span><span class="p">:</span> <span class="n">using</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">integer</span> <span class="n">number</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">an</span> <span class="n">integer</span> <span class="n">will</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">future</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># function evals   = 147</span>
    <span class="c1"># data points      = 200</span>
    <span class="c1"># variables        = 6</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">212.716</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">1.096</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="mf">24.328</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="mf">44.118</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">x0</span><span class="p">:</span>   <span class="mf">1.02060369</span> <span class="o">+/-</span> <span class="mf">0.181678</span> <span class="p">(</span><span class="mf">17.80</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span><span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">y0</span><span class="p">:</span>   <span class="mf">1.07048852</span> <span class="o">+/-</span> <span class="mf">0.110177</span> <span class="p">(</span><span class="mf">10.29</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span><span class="o">=</span> <span class="mf">1.997345</span><span class="p">)</span>
    <span class="n">a</span><span class="p">:</span>    <span class="mf">3.54326836</span> <span class="o">+/-</span> <span class="mf">0.454087</span> <span class="p">(</span><span class="mf">12.82</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span><span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">b</span><span class="p">:</span>    <span class="mf">1.21275230</span> <span class="o">+/-</span> <span class="mf">0.148458</span> <span class="p">(</span><span class="mf">12.24</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span><span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span><span class="p">:</span>    <span class="mf">0.84528522</span> <span class="o">+/-</span> <span class="mf">0.079480</span> <span class="p">(</span><span class="mf">9.40</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span><span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">d</span><span class="p">:</span>    <span class="mf">0.85717177</span> <span class="o">+/-</span> <span class="mf">0.085645</span> <span class="p">(</span><span class="mf">9.99</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span><span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">[[</span><span class="n">Correlations</span><span class="p">]]</span> <span class="p">(</span><span class="n">unreported</span> <span class="n">correlations</span> <span class="n">are</span> <span class="o">&lt;</span>  <span class="mf">0.100</span><span class="p">)</span>
    <span class="n">C</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>                      <span class="o">=</span>  <span class="mf">0.960</span>
    <span class="n">C</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>                      <span class="o">=</span> <span class="o">-</span><span class="mf">0.956</span>
    <span class="n">C</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>                      <span class="o">=</span> <span class="o">-</span><span class="mf">0.878</span>
    <span class="n">C</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>                     <span class="o">=</span> <span class="o">-</span><span class="mf">0.759</span>
    <span class="n">C</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>                     <span class="o">=</span> <span class="o">-</span><span class="mf">0.745</span>
    <span class="n">C</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>                     <span class="o">=</span> <span class="o">-</span><span class="mf">0.717</span>
    <span class="n">C</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>                     <span class="o">=</span> <span class="o">-</span><span class="mf">0.682</span>
    <span class="n">C</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>                      <span class="o">=</span>  <span class="mf">0.667</span>
    <span class="n">C</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>                     <span class="o">=</span>  <span class="mf">0.578</span>
    <span class="n">C</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>                      <span class="o">=</span> <span class="o">-</span><span class="mf">0.532</span>
    <span class="n">C</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>                     <span class="o">=</span>  <span class="mf">0.475</span>
    <span class="n">C</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>                      <span class="o">=</span> <span class="o">-</span><span class="mf">0.434</span>
    <span class="n">C</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>                     <span class="o">=</span>  <span class="mf">0.271</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_154_2.png" src="_images/14C_Optimization_In_Python_154_2.png" />
<div class="section" id="optimization-of-graph-node-placement">
<h4>Optimization of graph node placement<a class="headerlink" href="#optimization-of-graph-node-placement" title="Permalink to this headline">¶</a></h4>
<p>To show the many different applications of optimization, here is an
example using optimization to change the layout of nodes of a graph. We
use a physical analogy - nodes are connected by springs, and the springs
resist deformation from their natural length <span class="math">\(l_{ij}\)</span>. Some nodes
are pinned to their initial locations while others are free to move.
Because the initial configuration of nodes does not have springs at
their natural length, there is tension resulting in a high potential
energy <span class="math">\(U\)</span>, given by the physics formula shown below. Optimization
finds the configuration of lowest potential energy given that some nodes
are fixed (set up as boundary constraints on the positions of the
nodes).</p>
<div class="math">
\[U = \frac{1}{2}\sum_{i,j=1}^n ka_{ij}\left(||p_i - p_j||-l_{ij}\right)^2\]</div>
<p>Note that the ordination algorithm Multi-Dimensional Scaling (MDS) works
on a very similar idea - take a high dimensional data set in
<span class="math">\(\mathbb{R}^n\)</span>, and project down to a lower dimension
(<span class="math">\(\mathbb{R}^k\)</span>) such that the sum of distances
<span class="math">\(d_n(x_i, x_j) - d_k(x_i, x_j)\)</span>, where <span class="math">\(d_n\)</span> and <span class="math">\(d_k\)</span>
are some measure of distance between two points <span class="math">\(x_i\)</span> and
<span class="math">\(x_j\)</span> in <span class="math">\(n\)</span> and <span class="math">\(d\)</span> dimension respectively, is
minimized. MDS is often used in exploratory analysis of high-dimensional
data to get some intuitive understanding of its &#8220;structure&#8221;.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="k">import</span> <span class="n">pdist</span><span class="p">,</span> <span class="n">squareform</span>
</pre></div>
</div>
<ul class="simple">
<li>P0 is the initial location of nodes</li>
<li>P is the minimal energy location of nodes given constraints</li>
<li>A is a connectivity matrix - there is a spring between <span class="math">\(i\)</span> and
<span class="math">\(j\)</span> if <span class="math">\(A_{ij} = 1\)</span></li>
<li><span class="math">\(L_{ij}\)</span> is the resting length of the spring connecting
<span class="math">\(i\)</span> and <span class="math">\(j\)</span></li>
<li>In addition, there are a number of <code class="docutils literal"><span class="pre">fixed</span></code> nodes whose positions
are pinned.</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># spring stiffness</span>
<span class="n">P0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="n">A</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">tril_indices_from</span><span class="p">(</span><span class="n">A</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">squareform</span><span class="p">(</span><span class="n">pdist</span><span class="p">(</span><span class="n">P</span><span class="p">))</span>
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">D</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">D0</span> <span class="o">=</span> <span class="n">squareform</span><span class="p">(</span><span class="n">pdist</span><span class="p">(</span><span class="n">P0</span><span class="p">))</span>
<span class="n">E0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">D0</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">D0</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span> <span class="mf">0.</span>   <span class="p">,</span>  <span class="mf">5.039</span><span class="p">,</span>  <span class="mf">0.921</span><span class="p">,</span>  <span class="mf">1.758</span><span class="p">,</span>  <span class="mf">1.99</span> <span class="p">],</span>
       <span class="p">[</span> <span class="mf">5.039</span><span class="p">,</span>  <span class="mf">0.</span>   <span class="p">,</span>  <span class="mf">5.546</span><span class="p">,</span>  <span class="mf">3.414</span><span class="p">,</span>  <span class="mf">4.965</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.921</span><span class="p">,</span>  <span class="mf">5.546</span><span class="p">,</span>  <span class="mf">0.</span>   <span class="p">,</span>  <span class="mf">2.133</span><span class="p">,</span>  <span class="mf">2.888</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">1.758</span><span class="p">,</span>  <span class="mf">3.414</span><span class="p">,</span>  <span class="mf">2.133</span><span class="p">,</span>  <span class="mf">0.</span>   <span class="p">,</span>  <span class="mf">2.762</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">1.99</span> <span class="p">,</span>  <span class="mf">4.965</span><span class="p">,</span>  <span class="mf">2.888</span><span class="p">,</span>  <span class="mf">2.762</span><span class="p">,</span>  <span class="mf">0.</span>   <span class="p">]])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">E0</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span>  <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">8.159</span><span class="p">,</span>   <span class="mf">0.003</span><span class="p">,</span>   <span class="mf">0.288</span><span class="p">,</span>   <span class="mf">0.49</span> <span class="p">],</span>
       <span class="p">[</span>  <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.</span>   <span class="p">,</span>  <span class="mf">10.333</span><span class="p">,</span>   <span class="mf">2.915</span><span class="p">,</span>   <span class="mf">7.862</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.642</span><span class="p">,</span>   <span class="mf">1.782</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">1.552</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.</span>   <span class="p">,</span>   <span class="mf">0.</span>   <span class="p">]])</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">energy</span><span class="p">(</span><span class="n">P0</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
</pre></div>
</div>
<div class="math">
\[479.136508399\]</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># fix the position of the first few nodes just to show constraints</span>
<span class="n">fixed</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">P0</span><span class="p">[:</span><span class="n">fixed</span><span class="p">,:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span>
          <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">fixed</span><span class="p">)))</span>
<span class="n">bounds</span><span class="p">[:</span><span class="n">fixed</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="mf">1.191249528562059</span><span class="p">,</span> <span class="mf">1.191249528562059</span><span class="p">],</span>
 <span class="p">[</span><span class="mf">4.0389554314507805</span><span class="p">,</span> <span class="mf">4.0389554314507805</span><span class="p">],</span>
 <span class="p">[</span><span class="mf">4.474891439430058</span><span class="p">,</span> <span class="mf">4.474891439430058</span><span class="p">],</span>
 <span class="p">[</span><span class="mf">0.216114460398234</span><span class="p">,</span> <span class="mf">0.216114460398234</span><span class="p">],</span>
 <span class="p">[</span><span class="mf">1.5097341813135952</span><span class="p">,</span> <span class="mf">1.5097341813135952</span><span class="p">],</span>
 <span class="p">[</span><span class="mf">4.902910992971438</span><span class="p">,</span> <span class="mf">4.902910992971438</span><span class="p">],</span>
 <span class="p">[</span><span class="mf">2.6975241127686767</span><span class="p">,</span> <span class="mf">2.6975241127686767</span><span class="p">],</span>
 <span class="p">[</span><span class="mf">3.1315468085492815</span><span class="p">,</span> <span class="mf">3.1315468085492815</span><span class="p">],</span>
 <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
 <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
 <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
 <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">P0</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="visualization">
<h4>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h4>
<p>Original placement is BLUE Optimized arrangement is RED.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">P0</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">P0</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
<img alt="_images/14C_Optimization_In_Python_168_0.png" src="_images/14C_Optimization_In_Python_168_0.png" />
</div>
</div>
</div>
<div class="section" id="optimization-of-standard-statistical-models">
<h2>Optimization of standard statistical models<a class="headerlink" href="#optimization-of-standard-statistical-models" title="Permalink to this headline">¶</a></h2>
<p>When we solve standard statistical problems, an optimization procedure
similar to the ones discussed here is performed. For example, consider
multivariate logistic regression - typically, a Newton-like algorithm
known as iteratively reweighted least squares (IRLS) is used to find the
maximum likelihood estimate for the generalized linear model family.
However, using one of the multivariate scalar minimization methods shown
above will also work, for example, the BFGS minimization algorithm.</p>
<p>The take home message is that there is nothing magic going on when
Python or R fits a statistical model using a formula - all that is
happening is that the objective function is set to be the negative of
the log likelihood, and the minimum found using some first or second
order optimization algorithm.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
</pre></div>
</div>
<div class="section" id="logistic-regression-as-optimization">
<h3>Logistic regression as optimization<a class="headerlink" href="#logistic-regression-as-optimization" title="Permalink to this headline">¶</a></h3>
<p>Suppose we have a binary outcome measure <span class="math">\(Y \in {0,1}\)</span> that is
conditinal on some input variable (vector)
<span class="math">\(x \in (-\infty, +\infty)\)</span>. Let the conditioanl probability be
<span class="math">\(p(x) = P(Y=y | X=x)\)</span>. Given some data, one simple probability
model is <span class="math">\(p(x) = \beta_0 + x\cdot\beta\)</span> - i.e. linear regression.
This doesn&#8217;t really work for the obvious reason that <span class="math">\(p(x)\)</span> must
be between 0 and 1 as <span class="math">\(x\)</span> ranges across the real line. One simple
way to fix this is to use the transformation
<span class="math">\(g(x) = \frac{p(x)}{1 - p(x)} = \beta_0 + x.\beta\)</span>. Solving for
<span class="math">\(p\)</span>, we get</p>
<div class="math">
\[p(x) = \frac{1}{1 + e^{-(\beta_0 + x\cdot\beta)}}\]</div>
<p>As you all know very well, this is logistic regression.</p>
<p>Suppose we have <span class="math">\(n\)</span> data points <span class="math">\((x_i, y_i)\)</span> where
<span class="math">\(x_i\)</span> is a vector of features and <span class="math">\(y_i\)</span> is an observed class
(0 or 1). For each event, we either have &#8220;success&#8221; (<span class="math">\(y = 1\)</span>) or
&#8220;failure&#8221; (<span class="math">\(Y = 0\)</span>), so the likelihood looks like the product of
Bernoulli random variables. According to the logistic model, the
probability of success is <span class="math">\(p(x_i)\)</span> if <span class="math">\(y_i = 1\)</span> and
<span class="math">\(1-p(x_i)\)</span> if <span class="math">\(y_i = 0\)</span>. So the likelihood is</p>
<div class="math">
\[L(\beta_0, \beta) = \prod_{i=1}^n p(x_i)^y(1-p(x_i))^{1-y}\]</div>
<p>and the log-likelihood is</p>
<p>Using the standard &#8216;trick&#8217;, if we augment the matrix <span class="math">\(X\)</span> with a
column of 1s, we can write <span class="math">\(\beta_0 + x_i\cdot\beta\)</span> as just
<span class="math">\(X\beta\)</span>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">df_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;http://www.ats.ucla.edu/stat/data/binary.csv&quot;</span><span class="p">)</span>
<span class="n">df_</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>admit</th>
      <th>gre</th>
      <th>gpa</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>380</td>
      <td>3.61</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>660</td>
      <td>3.67</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>800</td>
      <td>4.00</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>640</td>
      <td>3.19</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>520</td>
      <td>2.93</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># We will ignore the rank categorical value</span>

<span class="n">cols_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;admit&#39;</span><span class="p">,</span> <span class="s1">&#39;gre&#39;</span><span class="p">,</span> <span class="s1">&#39;gpa&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[</span><span class="n">cols_to_keep</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;dummy&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>admit</th>
      <th>dummy</th>
      <th>gre</th>
      <th>gpa</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>380</td>
      <td>3.61</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>660</td>
      <td>3.67</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>800</td>
      <td>4.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>640</td>
      <td>3.19</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>1</td>
      <td>520</td>
      <td>2.93</td>
    </tr>
  </tbody>
</table>
</div></div>
<div class="section" id="solving-as-a-glm-with-irls">
<h3>Solving as a GLM with IRLS<a class="headerlink" href="#solving-as-a-glm-with-irls" title="Permalink to this headline">¶</a></h3>
<p>This is very similar to what you would do in R, only using Python&#8217;s
<code class="docutils literal"><span class="pre">statsmodels</span></code> package. The GLM solver uses a special variant of
Newton&#8217;s method known as iteratively reweighted least squares (IRLS),
which will be further desribed in the lecture on multivarite and
constrained optimizaiton.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">GLM</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s1">&#39;admit ~ gre + gpa&#39;</span><span class="p">,</span>
                            <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">())</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
<table class="simpletable">
<caption>Generalized Linear Model Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>        <td>admit</td>      <th>  No. Observations:  </th>  <td>   400</td>
</tr>
<tr>
  <th>Model:</th>                 <td>GLM</td>       <th>  Df Residuals:      </th>  <td>   397</td>
</tr>
<tr>
  <th>Model Family:</th>       <td>Binomial</td>     <th>  Df Model:          </th>  <td>     2</td>
</tr>
<tr>
  <th>Link Function:</th>        <td>logit</td>      <th>  Scale:             </th>    <td>1.0</td>
</tr>
<tr>
  <th>Method:</th>               <td>IRLS</td>       <th>  Log-Likelihood:    </th> <td> -240.17</td>
</tr>
<tr>
  <th>Date:</th>           <td>Thu, 09 Mar 2017</td> <th>  Deviance:          </th> <td>  480.34</td>
</tr>
<tr>
  <th>Time:</th>               <td>20:12:11</td>     <th>  Pearson chi2:      </th>  <td>  398.</td>
</tr>
<tr>
  <th>No. Iterations:</th>         <td>6</td>        <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th> <th>[95.0% Conf. Int.]</th>
</tr>
<tr>
  <th>Intercept</th> <td>   -4.9494</td> <td>    1.075</td> <td>   -4.604</td> <td> 0.000</td> <td>   -7.057    -2.842</td>
</tr>
<tr>
  <th>gre</th>       <td>    0.0027</td> <td>    0.001</td> <td>    2.544</td> <td> 0.011</td> <td>    0.001     0.005</td>
</tr>
<tr>
  <th>gpa</th>       <td>    0.7547</td> <td>    0.320</td> <td>    2.361</td> <td> 0.018</td> <td>    0.128     1.381</td>
</tr>
</table></div>
<div class="section" id="or-use-r">
<h3>Or use R<a class="headerlink" href="#or-use-r" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">rpy2</span><span class="o">.</span><span class="n">ipython</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">R</span> <span class="o">-</span><span class="n">i</span> <span class="n">df</span>
<span class="n">m</span> <span class="o">&lt;-</span> <span class="n">glm</span><span class="p">(</span><span class="n">admit</span> <span class="o">~</span> <span class="n">gre</span> <span class="o">+</span> <span class="n">gpa</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;binomial&quot;</span><span class="p">)</span>
<span class="n">summary</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">
Call:
glm(formula = admit ~ gre + gpa, family = &quot;binomial&quot;, data = df)

Deviance Residuals:
    Min       1Q   Median       3Q      Max
-1.2730  -0.8988  -0.7206   1.3013   2.0620

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)
(Intercept) -4.949378   1.075093  -4.604 4.15e-06 <strong>*
gre          0.002691   0.001057   2.544   0.0109 *
gpa          0.754687   0.319586   2.361   0.0182 *
---
Signif. codes:  0 ‘*</strong>’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 499.98  on 399  degrees of freedom
Residual deviance: 480.34  on 397  degrees of freedom
AIC: 486.34

Number of Fisher Scoring iterations: 4
</pre>
</div>
<div class="section" id="home-brew-logistic-regression-using-a-generic-minimization-function">
<h3>Home-brew logistic regression using a generic minimization function<a class="headerlink" href="#home-brew-logistic-regression-using-a-generic-minimization-function" title="Permalink to this headline">¶</a></h3>
<p>This is to show that there is no magic going on - you can write the
function to minimize directly from the log-likelihood equation and run a
minimizer. It will be more accurate if you also provide the derivative
(+/- the Hessian for second order methods), but using just the function
and numerical approximations to the derivative will also work. As usual,
this is for illustration so you understand what is going on - when there
is a library function available, you should probably use that instead.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Minus log likelihood function for logistic regression.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">((</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">))))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">)))</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">beta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">beta0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;admit&#39;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,</span> <span class="s1">&#39;dummy&#39;</span><span class="p">:]),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;BFGS&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gtol&#39;</span><span class="p">:</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>     <span class="n">fun</span><span class="p">:</span> <span class="mf">240.17199087261878</span>
<span class="n">hess_inv</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span> <span class="mf">1.115</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>   <span class="p">,</span> <span class="o">-</span><span class="mf">0.27</span> <span class="p">],</span>
      <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>   <span class="p">,</span>  <span class="mf">0.</span>   <span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>   <span class="p">],</span>
      <span class="p">[</span><span class="o">-</span><span class="mf">0.27</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>   <span class="p">,</span>  <span class="mf">0.098</span><span class="p">]])</span>
     <span class="n">jac</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.</span>   <span class="p">,</span> <span class="o">-</span><span class="mf">0.002</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.</span>   <span class="p">])</span>
 <span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Optimization terminated successfully.&#39;</span>
    <span class="n">nfev</span><span class="p">:</span> <span class="mi">65</span>
     <span class="n">nit</span><span class="p">:</span> <span class="mi">8</span>
    <span class="n">njev</span><span class="p">:</span> <span class="mi">13</span>
  <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
 <span class="n">success</span><span class="p">:</span> <span class="kc">True</span>
       <span class="n">x</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">4.949</span><span class="p">,</span>  <span class="mf">0.003</span><span class="p">,</span>  <span class="mf">0.755</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="optimization-with-sklearn">
<h3>Optimization with <code class="docutils literal"><span class="pre">sklearn</span></code><a class="headerlink" href="#optimization-with-sklearn" title="Permalink to this headline">¶</a></h3>
<p>There are also many optimization routines in the <code class="docutils literal"><span class="pre">scikit-learn</span></code>
package, as you already know from the previous lectures. Many machine
learning problems essentially boil down to the minimization of some
appropriate loss function.</p>
</div>
<div class="section" id="resources">
<h3>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/optimize.html">Scipy Optimize
reference</a></li>
<li><a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html">Scipy Optimize
tutorial</a></li>
<li><a class="reference external" href="http://cars9.uchicago.edu/software/python/lmfit/index.html">LMFit - a modeling interface for nonlinear least squares
problems</a></li>
<li><a class="reference external" href="https://github.com/cvxgrp/cvxpy">CVXpy- a modeling interface for convex optimization
problems</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Quasi-Newton_method">Quasi-Newton
methods</a></li>
<li><a class="reference external" href="http://stanford.edu/~boyd/cvxbook/">Convex optimization book by Boyd &amp;
Vandenberghe</a></li>
<li><a class="reference external" href="http://www.springer.com/us/book/9780387303031">Nocedal and Wright
textbook</a></li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="index-2.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="00_Jupyter.html">Notes on using Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_Introduction_To_Python.html">Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_Functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_Classes.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_Strings.html">Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_Numbers.html">Using <code class="docutils literal"><span class="pre">numpy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="06_Graphics.html">Graphics in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_Data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_SQL.html">SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_Machine_Learning.html">Machine Learning with <code class="docutils literal"><span class="pre">sklearn</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="10A_CodeOptimization.html">Code Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="10B_Numba.html">Just-in-time compilation (JIT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="10C_Cython.html">Cython</a></li>
<li class="toctree-l1"><a class="reference internal" href="11A_Parallel_Programming.html">Parallel Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="11B_Threads_Processses_Concurrency.html">Multi-Core Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="11C_IPyParallel.html">Using <code class="docutils literal"><span class="pre">ipyparallel</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="12A_C%2b%2b.html">Using C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="12B_C%2b%2b_Python_pybind11.html">Using <code class="docutils literal"><span class="pre">pybind11</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="13A_LinearAlgebra1.html">Linear Algebra Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="13A_LinearAlgebra1.html#linear-algebra-and-linear-systems">Linear Algebra and Linear Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="13B_LinearAlgebra2.html">Matrix Decompositions</a></li>
<li class="toctree-l1"><a class="reference internal" href="13C_LinearAlgebraExamples.html">Linear Algebra Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="13D_PCA.html">Applications of Linear Alebra: PCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="13E_SparseMatrices.html">Sparse Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="14A_Optimization_One_Dimension.html">Optimization and Root Finding</a></li>
<li class="toctree-l1"><a class="reference internal" href="14B_Multivariate_Optimization.html">Algorithms for Optimization and Root Finding for Multivariate Problems</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using optimization routines from <code class="docutils literal"><span class="pre">scipy</span></code> and <code class="docutils literal"><span class="pre">statsmodels</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#finding-roots">Finding roots</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimization-primer">Optimization Primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-scipy-optimize">Using <code class="docutils literal"><span class="pre">scipy.optimize</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#gradient-descent">Gradient descent</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimization-of-standard-statistical-models">Optimization of standard statistical models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="15A_Random_Numbers.html">Random numbers and probability models</a></li>
<li class="toctree-l1"><a class="reference internal" href="15B_ResamplingAndSimulation.html">Resampling and Monte Carlo Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="15C_MonteCarloIntegration.html">Numerical Evaluation of Integrals</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_PGM.html">Probabilistic Graphical Models with <code class="docutils literal"><span class="pre">pgmpy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="17_Functional_Programming.html">Working with large data sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="17A_Intermediate_Sized_Data.html">Biggish Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="17B_Big_Data_Structures.html">Efficient storage of data in memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="18A_Dask.html">Working with large data sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="10B_Numba.html">Just-in-time compilation (JIT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="18B_Spark.html">Using Spark</a></li>
<li class="toctree-l1"><a class="reference internal" href="18C_Efficiency_In_Spark.html">Using Spark Efficiently</a></li>
<li class="toctree-l1"><a class="reference internal" href="18D_Spark_MLib.html">Spark MLLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="18E_Spark_SQL.html">Spark SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="18G_Spark_Streaming.html">Spark Streaming</a></li>
<li class="toctree-l1"><a class="reference internal" href="18H_Spark_Cloud.html">Spark on Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="19A_PyMC3.html">Using PyMC3</a></li>
<li class="toctree-l1"><a class="reference internal" href="19B_Pystan.html">PyStan</a></li>
<li class="toctree-l1"><a class="reference internal" href="20A_MCMC.html">Metropolis and Gibbs Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="20B_AuxiliaryVariableMCMC.html">Using Auxiliary Variables in MCMC proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="Extras_01_The_Humble_For_Loop.html">Bonus Material: The Humble For Loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="Extras_02_Functional_Word_Counting.html">Bonus Material: Word count</a></li>
<li class="toctree-l1"><a class="reference internal" href="Extras_03_Symbolic_Algebra.html">Symbolic Algebra with <code class="docutils literal"><span class="pre">sympy</span></code></a></li>
</ul>
</div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="14B_Multivariate_Optimization.html"
                          title="Previous page">&larr; Algorithms for Optimization and Root Finding for Multivariate Problems</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="15A_Random_Numbers.html"
                          title="Next page">&rarr; Random numbers and probability models</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/14C_Optimization_In_Python.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="http://people.duke.edu/~ccc14/sta-663-2017/search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="15A_Random_Numbers.html" title="Random numbers and probability models"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="14B_Multivariate_Optimization.html" title="Algorithms for Optimization and Root Finding for Multivariate Problems"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="index-2.html">STA-663-2017 1.0 documentation</a> &#187;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Cliburn Chan and Janice McCarthy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>

<!-- Mirrored from people.duke.edu/~ccc14/sta-663-2017/14C_Optimization_In_Python.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 14 Apr 2017 01:12:12 GMT -->
</html>